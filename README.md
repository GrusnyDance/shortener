# Cервис, предоставляющий API по созданию сокращённых ссылок

Программа реализована как GRPC сервер c использованием плагина `grpc-gateway`. 
Плагин позволяет принимать http запросы и переводить их в GRPC с помощью обратного прокси сервера. Программа принимает два http метода - GET и POST. 
- POST принимает ссылку, которая должна быть захеширована, в виде джейсона. В ответе возвращается хеш (или ошибка), также джейсон.
- GET принимает хеш, по которому должна быть найдена оригинальная ссылка, в параметрах строки запроса (query string). Возвращается джейсон с оригинальной ссылкой/ошибкой.

Хешированные и оригинальные ссылки хранятся в постгрес базе или в мапе, в зависимости от параметров запуска.

### Запуск
Убедитесь что выключен впн и не заняты порты 8080 и 8085. Проверьте команду, которая поднимает docker-compose на вашей ОС (на моем линуксе это docker compose). Измените Makefile
при необходимости.

```
 make run_pg
 
 make run_cache # не запускать одновременно с run_pg, одинаковые порты
 ```

Дождитесь загрузки.

В мейкфайле также сть два базовых теста на работоспособность программы (интеграционные) + команда запуска юнит тестов. Также тесты и линтер автоматически запускаются в экшенах.
Есть команды генерации proto файлов, остановки контейнеров и их удаления, все это точно работает на линуксе.
После того как сервер будет остановлен, можно проверить логи в файле log.txt (прокинут как volume контейнера).

### Архитектура
Основные папки - cmd, internal, pkg. В сmd лежит main и осуществляется запуск программы, в pkg реализован алгоритм хеширования, остальная логика находится в internal.

Транспортный слой частично релизован за счет прото-файлов, частично в пакете app, где инициализируются grpc и http сервера. Бизнес-логика находится в пакете service, 
там же происходит обработка ошибок. Уровень работы с данными находится в storage, весь код который относится к бд хранится тоже там. В отдельную папку (entities) вынесен интерфейс хранилища, 
при наличии других интерфейсов они бы тоже находились там. Юнит тесты - в тех папках, в которых лежит тестируемый код.

### Хеширование
Для хеширования выбран алгоритм `sha256` который возвращает массив байтов фиксированного размера, который далее преобразуется в uint64. 
Полученное число используется для выбора индексов из последовательности разрешенных символов. Длина хеша не превышает 10 символов.
